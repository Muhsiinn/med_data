{% extends "base.html" %}

{% block page_title %}Manage Fields{% endblock %}

{% block content %}
<div class="card add-field-form">
    <h2 class="card-title">Add New Field</h2>
    <form method="POST">
        <input type="hidden" name="action" value="add">

        <div class="form-row">
            <div class="form-group">
                <label for="field_name">Field Name (internal) <span class="required">*</span></label>
                <input type="text" id="field_name" name="field_name"
                       placeholder="e.g., anxiety_level"
                       pattern="[a-z_]+"
                       title="Use lowercase letters and underscores only"
                       required>
            </div>

            <div class="form-group">
                <label for="field_label">Field Label (display) <span class="required">*</span></label>
                <input type="text" id="field_label" name="field_label"
                       placeholder="e.g., Anxiety Level"
                       required>
            </div>

            <div class="form-group">
                <label for="field_type">Field Type <span class="required">*</span></label>
                <select id="field_type" name="field_type" required>
                    <option value="number">Number</option>
                    <option value="text">Text</option>
                    <option value="date">Date</option>
                    <option value="textarea">Text Area</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="field_min">Min Value (for numbers)</label>
                <input type="number" id="field_min" name="field_min" placeholder="e.g., 0">
            </div>

            <div class="form-group">
                <label for="field_max">Max Value (for numbers)</label>
                <input type="number" id="field_max" name="field_max" placeholder="e.g., 10">
            </div>

            <div class="form-group">
                <label for="field_required">
                    <input type="checkbox" id="field_required" name="field_required" style="width: auto; margin-right: 5px;">
                    Required Field
                </label>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Add Field</button>
    </form>
</div>

<div class="card">
    <h2 class="card-title">Current Fields</h2>
    <div class="field-list">
        {% for field_name, field_config in fields.items() %}
        <div class="field-item">
            <div class="field-info">
                <div class="field-name">{{ field_config.label }}</div>
                <div class="field-details">
                    <span class="field-badge badge-type">{{ field_config.type }}</span>
                    {% if field_config.required %}
                        <span class="field-badge badge-required">Required</span>
                    {% else %}
                        <span class="field-badge badge-optional">Optional</span>
                    {% endif %}
                    {% if field_config.min is not none %}
                        <span class="field-badge badge-type">Min: {{ field_config.min }}</span>
                    {% endif %}
                    {% if field_config.max is not none %}
                        <span class="field-badge badge-type">Max: {{ field_config.max }}</span>
                    {% endif %}
                    <code style="color: #868e96; margin-left: 10px;">{{ field_name }}</code>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                {% if field_name not in ['date', 'notes', 'thoughts', 'remarks'] %}
                <a href="{{ url_for('edit_field', field_name=field_name) }}" class="btn btn-edit">Edit</a>
                <form method="POST" style="display: inline;">
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="field_to_delete" value="{{ field_name }}">
                    <button type="submit" class="btn btn-danger"
                            onclick="return confirm('Delete this field? Data will be preserved.')">
                        Delete
                    </button>
                </form>
                {% else %}
                    {% if field_name not in ['date'] %}
                    <a href="{{ url_for('edit_field', field_name=field_name) }}" class="btn btn-edit">Edit</a>
                    {% endif %}
                    <span style="color: #757575; font-size: 12px;">Protected</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="actions">
    <form method="POST" action="{{ url_for('reset_fields') }}" style="display: inline;">
        <button type="submit" class="btn btn-secondary"
                onclick="return confirm('Reset all fields to default configuration?')">
            Reset to Defaults
        </button>
    </form>
</div>

{% endblock %}
